# tempo helm values (base)
# Optimized for 2-node homelab cluster - single binary mode

# Resource configuration
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    memory: 512Mi

# Persistence
persistence:
  enabled: true
  size: 2Gi
  storageClassName: longhorn

# Tempo configuration
tempo:
  # Enable trace receivers
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: "0.0.0.0:4317"
        http:
          endpoint: "0.0.0.0:4318"
    zipkin:
      endpoint: "0.0.0.0:9411"
    jaeger:
      protocols:
        thrift_compact:
          endpoint: "0.0.0.0:6831"
        thrift_http:
          endpoint: "0.0.0.0:14268"

  # S3 storage backend - external Minio on node1
  storage:
    trace:
      backend: s3
      s3:
        bucket: k3s-tempo
        endpoint: https://10.0.0.11:9091
        access_key: ${MINIO_ACCESS_KEY_ID}
        secret_key: ${MINIO_SECRET_ACCESS_KEY}
        insecure_skip_verify: true

  # Retention
  retention: 72h

  # Query configuration
  query_frontend: {}

# Extra environment variables for S3 credentials
extraEnv:
  - name: MINIO_ACCESS_KEY_ID
    valueFrom:
      secretKeyRef:
        name: tempo-minio-secret
        key: MINIO_ACCESS_KEY_ID
  - name: MINIO_SECRET_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        name: tempo-minio-secret
        key: MINIO_SECRET_ACCESS_KEY

# Extra args to expand environment variables
extraArgs:
  - "-config.expand-env=true"

# Service monitor for Prometheus
serviceMonitor:
  enabled: true
