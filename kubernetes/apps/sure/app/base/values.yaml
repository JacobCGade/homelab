# Sure Helm Values - Base Configuration

# Disable built-in database operators (using external PostgreSQL and Redis)
cnpg:
  enabled: false
  cluster:
    enabled: false

redisOperator:
  enabled: false
  managed:
    enabled: false

redisSimple:
  enabled: false

# Rails configuration
rails:
  env: production
  existingSecret: sure-app
  extraEnv:
    DATABASE_URL: "postgresql://sure:$(DB_PASSWORD)@sure-postgres.sure.svc.cluster.local:5432/sure?sslmode=prefer"
    REDIS_URL: "redis://:$(REDIS_PASSWORD)@sure-redis.sure.svc.cluster.local:6379/0"

# Image configuration
image:
  repository: ghcr.io/we-promise/sure
  tag: "0.6.7"
  pullPolicy: IfNotPresent

# Web deployment configuration
web:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      memory: 512Mi
  startupProbe:
    httpGet:
      path: /up
      port: http
    failureThreshold: 30
    periodSeconds: 5
  livenessProbe:
    httpGet:
      path: /up
      port: http
    initialDelaySeconds: 20
    periodSeconds: 10
    timeoutSeconds: 2
    failureThreshold: 6
  readinessProbe:
    httpGet:
      path: /up
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 2
    failureThreshold: 6

# Worker (Sidekiq) configuration
worker:
  replicas: 1
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      memory: 256Mi

# Service configuration
service:
  type: ClusterIP
  port: 80

# Disable HPA for resource-constrained cluster
autoscaling:
  enabled: false

# Security context
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault
